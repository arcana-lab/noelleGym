#!/bin/bash -e

# wait until condor job finishes
runningMinute=0 ;

while [ true ] ; do
  sleep 15m ;
  fetchRunningJobNum="condor_q `whoami` -run -l | grep ^Arguments | grep `pwd` | wc -l" ;
  runningJobNum=`eval $fetchRunningJobNum` ;

  if [[ $runningJobNum -ne 0 ]] ; then
    echo "Your job has finished." ;
    exit 0 ;
  else
    runningMinute=$(( $runningMinute + 15 )) ;
    hour=$(( $runningMinute / 60 )) ;
    minute=$(( $runningMinute % 60 )) ;
    mod10=$(( $minute % 10 )) ;
    if [[ $mod10 -eq 0 ]] ; then
      echo "Your job has executed for ${hour}h${minute}m." ;
    fi
  fi
done
