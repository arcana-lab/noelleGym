#!/bin/bash -e

# wait until condor job finishes
runningMinute=0 ;

while [ true ] ; do
  sleep 5m ;
  # https://pages.cs.wisc.edu/~adesmet/status.html
  idle=1 ;
  running=2 ;
  suspended=5 ;
  fetchRunningJobNum="condor_q `whoami` -constraint \"JobStatus == ${idle} || JobStatus == ${running} || JobStatus == ${suspended}\" -l | grep ^Arguments | grep `pwd` | wc -l" ;
  runningJobNum=`eval $fetchRunningJobNum` ;

  if [[ $runningJobNum -eq 0 ]] ; then
    echo "Your job has finished." ;
    exit 0 ;
  else
    runningMinute=$(( $runningMinute + 5 )) ;
    hour=$(( $runningMinute / 60 )) ;
    minute=$(( $runningMinute % 60 )) ;
    mod10=$(( $minute % 10 )) ;
    if [[ $mod10 -eq 0 ]] ; then
      echo "Your job has executed for ${hour}h${minute}m." ;
    fi
  fi
done
